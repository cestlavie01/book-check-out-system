// Prisma Schema - 데이터베이스 구조를 정의하는 파일
// 이 파일에서 테이블(모델)과 관계를 정의합니다

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

// ========================================
// 사용자 (User) 모델
// Google OAuth로 로그인한 사용자 정보를 저장
// ========================================
model User {
  id            String    @id @default(cuid())  // 고유 ID
  email         String    @unique               // 이메일 (유니크)
  name          String?                         // 이름 (선택)
  image         String?                         // 프로필 이미지 URL
  role          Role      @default(USER)        // 역할 (USER 또는 ADMIN)
  createdAt     DateTime  @default(now())       // 생성일
  updatedAt     DateTime  @updatedAt            // 수정일

  // 관계: 사용자가 빌린 대출 기록들
  checkouts     Checkout[]
}

// 사용자 역할 (열거형)
enum Role {
  USER   // 일반 이용자
  ADMIN  // 관리자
}

// ========================================
// 선반 (Shelf) 모델
// 책이 보관되는 위치
// ========================================
model Shelf {
  id          String   @id @default(cuid())
  name        String                          // 선반 이름 (예: "A-1", "2층 왼쪽")
  location    String?                         // 위치 설명
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // 관계: 이 선반에 있는 책들
  books       Book[]
}

// ========================================
// 책 (Book) 모델
// ========================================
model Book {
  id          String   @id @default(cuid())
  title       String                          // 책 제목
  author      String                          // 저자
  isbn        String?  @unique                // ISBN (선택, 유니크)
  description String?                         // 설명
  coverImage  String?                         // 표지 이미지 URL
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // 관계: 책이 있는 선반
  shelfId     String?
  shelf       Shelf?   @relation(fields: [shelfId], references: [id])

  // 관계: 이 책의 대출 기록들
  checkouts   Checkout[]
}

// ========================================
// 대출 기록 (Checkout) 모델
// 누가 어떤 책을 언제 빌렸는지 기록
// ========================================
model Checkout {
  id          String    @id @default(cuid())
  borrowedAt  DateTime  @default(now())       // 대출일
  dueDate     DateTime                        // 반납 예정일
  returnedAt  DateTime?                       // 실제 반납일 (null이면 아직 대출중)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // 관계: 빌린 사용자
  userId      String
  user        User      @relation(fields: [userId], references: [id])

  // 관계: 빌린 책
  bookId      String
  book        Book      @relation(fields: [bookId], references: [id])
}
